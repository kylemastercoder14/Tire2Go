generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Users {
  id              String   @id @default(uuid())
  authId          String?  @unique // from Clerk
  email           String   @unique
  password        String
  firstName       String
  lastName        String
  mobileNumber    String
  ipAddress       String?
  userAgent       String?
  deviceType      String? // mobile/tablet/desktop
  isEmailVerified Boolean  @default(false)
  role            String   @default("USER") // USER, ADMIN
  userType        UserType @default(CUSTOMER) // ADMIN, CUSTOMER
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  feedback     Feedback[]
  ticket       Ticket[]
  cart         Cart[]
  systemLogs   SystemLogs[]
  order        Order[]
  conversation Conversation[]
  reviews      Review[]
}

model Staff {
  id              String   @id @default(uuid())
  firstName       String
  lastName        String
  email           String   @unique
  password        String
  role            String // e.g., "Manager", "Sales", "Support"
  isEmailVerified Boolean  @default(false)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Brands {
  id          String   @id @default(uuid())
  name        String
  description String
  logo        String
  type        String // e.g., "Premium", "Mid-range", "Budget"
  thumbnail   String
  colorScheme Json?   // Color scheme for brand theming: { primary: "#hex", secondary: "#hex", accent: "#hex" }
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  products Products[]
}

model Products {
  id              String   @id @default(uuid())
  name            String
  promotionsId    String?
  description     String
  price           Float
  images          String[]
  threeDModel     String?  // optional URL/path to 3D model (.glb)
  inclusion       String
  warranty        String
  tireSize        String?
  isClearanceSale Boolean  @default(false)
  discountedPrice Float?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  brandId String
  brand   Brands @relation(fields: [brandId], references: [id])

  inventory            Inventory[]
  cartItem             CartItem[]
  orderItem            OrderItem[]
  productCompatibility ProductCompatibility[]
  productSize          ProductSize[]
  reviews              Review[]
}

model TireSize {
  id       String @id @default(uuid())
  width    Int // e.g., 155
  ratio    Int? // aspect ratio, e.g., 30
  diameter Int? // rim diameter, e.g., 13

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  products ProductSize[]
}

model ProductSize {
  id        String   @id @default(uuid())
  productId String
  product   Products @relation(fields: [productId], references: [id])

  tireSizeId String
  tireSize   TireSize @relation(fields: [tireSizeId], references: [id])

  price           Float   @default(0) // Price for this specific tire size
  isClearanceSale Boolean @default(false)
  discountedPrice Float?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CarMake {
  id   String @id @default(uuid())
  name String @unique // e.g., "MITSUBISHI", "TOYOTA"

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  models CarModel[]
}

model CarModel {
  id     String  @id @default(uuid())
  name   String // e.g., "LANCER", "VIOS"
  makeId String
  make   CarMake @relation(fields: [makeId], references: [id])
  years  Int[]   @default([]) // Array of years of manufacture (e.g., [2015, 2016, 2017, ..., 2025])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  compatibilities ProductCompatibility[]
}

model ProductCompatibility {
  id        String   @id @default(uuid())
  productId String
  product   Products @relation(fields: [productId], references: [id])

  modelId String
  model   CarModel @relation(fields: [modelId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  year Int // Year of the car this tire is compatible with
}

model Inventory {
  id            String    @id @default(uuid())
  quantity      Int // current stock on hand
  minStock      Int // threshold for "low stock" alerts
  maxStock      Int? // optional: max capacity (warehouse limit)
  sku           String?   @unique
  status        String    @default("IN_STOCK") // IN_STOCK, LOW_STOCK, OUT_OF_STOCK, DISCONTINUED
  lastRestocked DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  productId String
  product   Products @relation(fields: [productId], references: [id])
}

model TipsGuides {
  id        String   @id @default(uuid())
  title     String
  content   String
  thumbnail String?
  category  String // e.g., "Maintenance", "Buying Guide", "Safety Tips"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Faqs {
  id        String   @id @default(uuid())
  question  String
  answer    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Policies {
  id        String   @id @default(uuid())
  type      String // e.g., "Privacy Policy", "Return Policy", "Shipping Policy"
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Promotions {
  id          String   @id @default(uuid())
  name        String
  description String
  criteria    String
  thumbnail   String
  startDate   DateTime
  endDate     DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Feedback {
  id        String   @id @default(uuid())
  userId    String
  rating    Int // e.g., 1 to 5
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user Users @relation(fields: [userId], references: [id])
}

model Ticket {
  id          String         @id @default(uuid())
  userId      String
  subject     String
  description String
  status      TicketStatus   @default(OPEN)
  priority    TicketPriority @default(MEDIUM)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  user Users @relation(fields: [userId], references: [id])
}

model Cart {
  id        String   @id @default(uuid())
  userId    String
  total     Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user     Users      @relation(fields: [userId], references: [id])
  cartItem CartItem[]
}

model CartItem {
  id        String   @id @default(uuid())
  cartId    String
  productId String
  quantity  Int
  price     Float // price at the time of adding to cart
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  cart    Cart     @relation(fields: [cartId], references: [id])
  product Products @relation(fields: [productId], references: [id])
}

model SystemLogs {
  id        String   @id @default(uuid())
  action    String
  details   String?
  userId    String?
  ipAddress String?
  userAgent String?
  timestamp DateTime @default(now())

  user Users? @relation(fields: [userId], references: [id])
}

model Order {
  id               String        @id @default(uuid())
  userId           String
  totalAmount      Float
  discountedAmount Float?
  name             String
  email            String
  phoneNumber      String
  status           OrderStatus   @default(PENDING)
  paymentStatus    PaymentStatus @default(PENDING)
  orderOption      String
  preferredDate    DateTime
  remarks          String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  processingAt DateTime?
  shippedAt    DateTime?
  completedAt  DateTime?

  reasonCancelled String?
  cancelledAt     DateTime?

  isArchived Boolean   @default(false)
  archivedAt DateTime?

  user      Users       @relation(fields: [userId], references: [id])
  orderItem OrderItem[]
}

model OrderItem {
  id        String   @id @default(uuid())
  orderId   String
  productId String
  quantity  Int
  price     Float // unit price
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  order   Order    @relation(fields: [orderId], references: [id])
  product Products @relation(fields: [productId], references: [id])
}

model Conversation {
  id        String             @id @default(cuid())
  userId    String?
  user      Users?             @relation(fields: [userId], references: [authId])
  status    ConversationStatus @default(OPEN)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt

  messages Message[]
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  senderType SenderType
  senderId   String? // optional, kung gusto mong i-track kung aling admin/staff ang sumagot
  content    String
  createdAt  DateTime   @default(now())
}

enum SenderType {
  CUSTOMER
  SYSTEM
}

enum ConversationStatus {
  OPEN
  PENDING
  CLOSED
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum UserType {
  ADMIN
  CUSTOMER
}

model BackupHistory {
  id        String   @id @default(cuid())
  action    String
  filename  String
  status    String
  createdAt DateTime @default(now())
}

model Review {
  id        String   @id @default(uuid())
  productId String
  product   Products @relation(fields: [productId], references: [id], onDelete: Cascade)
  userId    String
  user      Users    @relation(fields: [userId], references: [id])
  rating    Int      // 1 to 5
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([productId])
  @@index([userId])
}
